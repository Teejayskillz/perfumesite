{% extends 'base.html' %}
{% block content %}
<div class="container max-w-4xl mx-auto py-6">
  <div class="bg-gray-900 rounded-xl shadow p-4 md:p-6">
    <div class="flex flex-col md:flex-row gap-4">
      {% if perfume.image %}
        <img src="{{ perfume.image.url }}" alt="{{ perfume.name }}" class="w-full md:w-1/3 rounded-lg object-cover">
      {% elif perfume.image_url %}
        <img src="{{ perfume.image_url }}" alt="{{ perfume.name }}" class="w-full md:w-1/3 rounded-lg object-cover">
      {% else %}
        <div class="w-full md:w-1/3 bg-gray-800 h-64 flex items-center justify-center text-gray-500">No Image</div>
      {% endif %}

      <div class="flex-1 text-white">
        <h1 class="text-2xl font-bold">{{ perfume.name }}</h1>
        <p class="text-gray-400 mb-2">{{ perfume.brand }} ‚Ä¢ {{ perfume.country }}</p>
        <p class="text-yellow-400 mb-4">‚≠ê {{ perfume.rating_value|default:"‚Äì" }} ({{ perfume.rating_count|default:0 }})</p>

        {% if perfume.year %}
        <p class="mb-2"><strong>Released:</strong> {{ perfume.year }}</p>
        {% endif %}

        <p class="text-gray-300 mb-4">{{ perfume.description|linebreaks }}</p>
        <div class="mt-6 text-center">
          <a 
            href="{% url 'compare_perfumes' %}?perfumes={{ perfume.id }}" 
            class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200"
          >
            üîç Compare with Another Perfume
          </a>
        </div>

        <div class="space-y-2 text-sm text-gray-400 mt-6">
          <p><strong>Top Notes:</strong> {{ perfume.top_notes }}</p>
          <p><strong>Middle Notes:</strong> {{ perfume.middle_notes }}</p>
          <p><strong>Base Notes:</strong> {{ perfume.base_notes }}</p>
        </div>
      </div>
    </div>

    <div class="mt-6 text-gray-400 text-sm">
      <p><strong>Perfumer(s):</strong> {{ perfume.perfumer1 }}{% if perfume.perfumer2 %}, {{ perfume.perfumer2 }}{% endif %}</p>
      <p><strong>Main Accords:</strong> {{ perfume.mainaccord1 }}, {{ perfume.mainaccord2 }}, {{ perfume.mainaccord3 }}, {{ perfume.mainaccord4 }}, {{ perfume.mainaccord5 }}</p>
      <a href="{{ perfume.url }}" target="_blank" class="text-blue-400 hover:underline mt-2 inline-block">View on Fragrantica</a>

      <!-- üîó Share Buttons -->
      <div class="mt-4 flex justify-center gap-3">
        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
           target="_blank"
           class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
           Facebook
        </a>
        <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text=Check out this perfume!"
           target="_blank"
           class="bg-blue-400 hover:bg-blue-500 text-white px-4 py-2 rounded-lg transition">
           Twitter
        </a>
        <a href="https://wa.me/?text=Check out this perfume: {{ request.build_absolute_uri }}"
           target="_blank"
           class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition">
           WhatsApp
        </a>
        <button 
           onclick="navigator.clipboard.writeText('{{ request.build_absolute_uri }}').then(() => alert('Link copied!'))"
           class="bg-gray-700 hover:bg-gray-800 text-white px-4 py-2 rounded-lg transition">
           Copy Link
        </button>
      </div>
    </div>

    {% if similar_perfumes %}
      <div class="mt-10">
        <h2 class="text-xl font-bold text-yellow-400 mb-4">Similar Perfumes</h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
          {% for p in similar_perfumes %}
            <a href="{% url 'perfume_detail' pk=p.pk %}" class="block bg-gray-900 rounded-lg shadow hover:shadow-lg transition p-2">
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="{{ p.name }}" class="w-full h-32 object-cover rounded-md mb-2">
              {% elif p.image_url %}
                <img src="{{ p.image_url }}" alt="{{ p.name }}" class="w-full h-32 object-cover rounded-md mb-2">
              {% endif %}
              <h3 class="text-white font-semibold truncate">{{ p.name }}</h3>
              <p class="text-gray-400 text-sm">{{ p.brand }}</p>
            </a>
          {% endfor %}
        </div>
      </div>
    {% endif %}
<!-- üí¨ Reviews Section -->
<div class="mt-10 bg-gray-900 rounded-xl p-6">
  <h2 class="text-xl font-semibold text-white mb-4">Reviews</h2>

  <form method="post" class="mb-6">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">
      Post Review
    </button>
  </form>

  {% if reviews %}
    <div class="space-y-4">
      {% for review in reviews %}
        <div class="bg-gray-800 p-4 rounded-lg">
          <p class="text-gray-200 mb-2">{{ review.content }}</p>
          <p class="text-gray-500 text-sm">
            ‚Äî {{ review.name }} ‚Ä¢ {{ review.created_at|date:"M d, Y H:i" }}
          </p>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-gray-500">No reviews yet. Be the first to comment!</p>
  {% endif %}
</div>

  </div>
</div>
{% endblock %}
