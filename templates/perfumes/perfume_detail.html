{% extends 'base.html' %}
{% block content %}

<style>
  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes shimmerText {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(2deg); }
  }

  .detail-container {
    animation: fadeInScale 0.6s ease-out;
  }

  .perfume-image-detail {
    animation: float 6s ease-in-out infinite;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .perfume-image-detail:hover {
    transform: scale(1.05) rotate(3deg);
  }

  .image-glow {
    position: relative;
  }

  .image-glow::before {
    content: '';
    position: absolute;
    inset: -20px;
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.4), rgba(212, 175, 55, 0.1));
    border-radius: 24px;
    filter: blur(30px);
    opacity: 0.6;
    z-index: -1;
  }

  /* --- BEGIN Mobile Image Adjustment --- */
  .perfume-image-sticky-wrapper {
    /* Default for larger screens */
    position: sticky;
    top: 6rem; /* Equivalent to Tailwind's top-24 (24 * 0.25rem = 6rem) */
  }

  @media (max-width: 1023px) { /* Adjust for mobile/small screens (lg: break point is 1024px) */
    .perfume-image-sticky-wrapper {
      /* Pushes the image up to only stick 1rem (4px) from the top */
      top: 1rem; /* Adjust this value (e.g., 0.5rem, 1rem, 2rem) as needed */
    }
  }
  /* --- END Mobile Image Adjustment --- */

  .gold-badge {
    background: linear-gradient(135deg, #d4af37, #f4e4b8);
    box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
  }

  .note-card {
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.02));
    border: 1px solid rgba(212, 175, 55, 0.2);
    transition: all 0.3s ease;
  }

  .note-card:hover {
    background: rgba(212, 175, 55, 0.1);
    border-color: rgba(212, 175, 55, 0.4);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(212, 175, 55, 0.2);
  }

  .share-button {
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .share-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transform: translate(-50%, -50%);
    transition: width 0.4s, height 0.4s;
  }

  .share-button:hover::before {
    width: 300px;
    height: 300px;
  }

  .share-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .luxury-button {
    background: linear-gradient(135deg, #d4af37, #f4e4b8);
    box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .luxury-button::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s;
  }

  .luxury-button:hover::after {
    left: 100%;
  }

  .luxury-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
  }

  .section-divider {
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
    opacity: 0.3;
  }

  .review-card {
    background: linear-gradient(135deg, rgba(212, 175, 55, 0.03), rgba(0, 0, 0, 0.5));
    border: 1px solid rgba(212, 175, 55, 0.15);
    transition: all 0.3s ease;
  }

  .review-card:hover {
    border-color: rgba(212, 175, 55, 0.3);
    transform: translateX(5px);
  }

  .similar-perfume-card {
    transition: all 0.3s ease;
    border: 1px solid rgba(212, 175, 55, 0.1);
  }

  .similar-perfume-card:hover {
    transform: translateY(-8px);
    border-color: rgba(212, 175, 55, 0.4);
    box-shadow: 0 12px 30px rgba(212, 175, 55, 0.2);
  }

  .rating-stars {
    color: #d4af37;
    text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
  }
</style>

<div class="container max-w-6xl mx-auto py-8 px-4">
  <div class="detail-container bg-gradient-to-br from-gray-900 to-black rounded-3xl shadow-2xl p-6 md:p-10 border border-gray-800">
    
    <div class="flex flex-col lg:flex-row gap-8 mb-10">
      
      <div class="lg:w-2/5">
        <div class="image-glow perfume-image-sticky-wrapper">
          {% if perfume.image %}
            <img src="{{ perfume.image.url }}" alt="{{ perfume.name }} - {{ perfume.brand }} Fragrance Details" 
                 class="perfume-image-detail w-full rounded-2xl object-cover shadow-2xl">
          {% elif perfume.image_url %}
            <img src="{{ perfume.image_url }}" alt="{{ perfume.name }} - {{ perfume.brand }} Fragrance Details" 
                 class="perfume-image-detail w-full rounded-2xl object-cover shadow-2xl">
          {% else %}
            <div class="w-full bg-gradient-to-br from-gray-800 to-gray-900 h-96 flex flex-col items-center justify-center text-gray-500 rounded-2xl border-2 border-dashed border-gray-700">
              <span class="text-6xl mb-4 opacity-30">‚ú¶</span>
              <span class="text-lg">No Image Available</span>
            </div>
          {% endif %}
        </div>
      </div>

      <div class="lg:w-3/5 space-y-6">
        
        <div>
          <div class="flex items-center gap-3 mb-3">
            <span class="gold-badge text-black text-xs font-bold px-4 py-1 rounded-full uppercase tracking-wider">
              Premium Fragrance
            </span>
          </div>
          <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-3 leading-tight">
            {{ perfume.name }}
          </h1>
          <div class="flex items-center gap-4 text-lg text-gray-400 mb-4">
            <span class="text-[var(--gold)] font-semibold">{{ perfume.brand }}</span>
            <span class="text-gray-600">‚Ä¢</span>
            <span>{{ perfume.country }}</span>
            {% if perfume.year %}
              <span class="text-gray-600">‚Ä¢</span>
              <span>{{ perfume.year }}</span>
            {% endif %}
          </div>
          
          <div class="flex items-center gap-2 mb-6">
            <span class="rating-stars text-2xl">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            <span class="text-[var(--gold)] font-bold text-xl">{{ perfume.rating_value|default:"‚Äì" }}</span>
            <span class="text-gray-500">({{ perfume.rating_count|default:0 }} reviews)</span>
          </div>
        </div>

        <div class="section-divider"></div>

        <div class="text-gray-300 leading-relaxed text-lg">
          {{ perfume.description|linebreaks }}
        </div>

        <div>
          <a href="{% url 'compare_perfumes' %}?perfumes={{ perfume.id }}" 
             class="luxury-button inline-flex items-center gap-3 text-black font-bold py-4 px-8 rounded-xl transition duration-300 text-lg">
            <span class="text-xl">‚öñÔ∏è</span>
            Compare with Another Perfume
          </a>
        </div>

        <div class="section-divider"></div>

        <div class="space-y-4">
          <h2 class="text-2xl font-bold text-[var(--gold)] mb-4">Fragrance Profile</h2>
          
          <div class="note-card rounded-xl p-5">
            <div class="flex items-center gap-3 mb-2">
              <span class="text-2xl">üå∏</span>
              <h3 class="font-bold text-white text-lg">Top Notes</h3>
            </div>
            <p class="text-gray-300 ml-11">{{ perfume.top_notes }}</p>
          </div>

          <div class="note-card rounded-xl p-5">
            <div class="flex items-center gap-3 mb-2">
              <span class="text-2xl">üå∫</span>
              <h3 class="font-bold text-white text-lg">Middle Notes</h3>
            </div>
            <p class="text-gray-300 ml-11">{{ perfume.middle_notes }}</p>
          </div>

          <div class="note-card rounded-xl p-5">
            <div class="flex items-center gap-3 mb-2">
              <span class="text-2xl">ü™µ</span>
              <h3 class="font-bold text-white text-lg">Base Notes</h3>
            </div>
            <p class="text-gray-300 ml-11">{{ perfume.base_notes }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="section-divider my-10"></div>

    <div class="grid md:grid-cols-2 gap-6 mb-10">
      <div class="bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-6 border border-gray-700">
        <h3 class="text-[var(--gold)] font-bold text-lg mb-4">Perfumer(s)</h3>
        <p class="text-gray-300 text-lg">
          {{ perfume.perfumer1 }}{% if perfume.perfumer2 %}, {{ perfume.perfumer2 }}{% endif %}
        </p>
      </div>

      <div class="bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-6 border border-gray-700">
        <h3 class="text-[var(--gold)] font-bold text-lg mb-4">Main Accords</h3>
        <div class="flex flex-wrap gap-2">
          {% if perfume.mainaccord1 %}
            <span class="bg-[var(--gold)]/20 text-[var(--gold)] px-3 py-1 rounded-full text-sm border border-[var(--gold)]/30">
              {{ perfume.mainaccord1 }}
            </span>
          {% endif %}
          {% if perfume.mainaccord2 %}
            <span class="bg-[var(--gold)]/20 text-[var(--gold)] px-3 py-1 rounded-full text-sm border border-[var(--gold)]/30">
              {{ perfume.mainaccord2 }}
            </span>
          {% endif %}
          {% if perfume.mainaccord3 %}
            <span class="bg-[var(--gold)]/20 text-[var(--gold)] px-3 py-1 rounded-full text-sm border border-[var(--gold)]/30">
              {{ perfume.mainaccord3 }}
            </span>
          {% endif %}
          {% if perfume.mainaccord4 %}
            <span class="bg-[var(--gold)]/20 text-[var(--gold)] px-3 py-1 rounded-full text-sm border border-[var(--gold)]/30">
              {{ perfume.mainaccord4 }}
            </span>
          {% endif %}
          {% if perfume.mainaccord5 %}
            <span class="bg-[var(--gold)]/20 text-[var(--gold)] px-3 py-1 rounded-full text-sm border border-[var(--gold)]/30">
              {{ perfume.mainaccord5 }}
            </span>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="bg-gradient-to-r from-gray-900 to-gray-800 rounded-xl p-6 mb-10 border border-gray-700">
      <h3 class="text-white font-bold text-xl mb-4 text-center">Share This Fragrance</h3>
      <div class="flex flex-wrap justify-center gap-4">
        <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
           target="_blank" rel="noopener"
           class="share-button bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl transition font-semibold flex items-center gap-2">
           <span>üìò</span> Facebook
        </a>
        <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text=Check out this perfume!"
           target="_blank" rel="noopener"
           class="share-button bg-sky-500 hover:bg-sky-600 text-white px-6 py-3 rounded-xl transition font-semibold flex items-center gap-2">
           <span>üê¶</span> Twitter
        </a>
        <a href="https://wa.me/?text=Check out this perfume: {{ request.build_absolute_uri }}"
           target="_blank" rel="noopener"
           class="share-button bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl transition font-semibold flex items-center gap-2">
           <span>üí¨</span> WhatsApp
        </a>
        <button onclick="navigator.clipboard.writeText('{{ request.build_absolute_uri }}').then(() => alert('Link copied to clipboard!'))"
           class="share-button bg-gray-700 hover:bg-gray-600 text-white px-6 py-3 rounded-xl transition font-semibold flex items-center gap-2">
           <span>üîó</span> Copy Link
        </button>
      </div>
      <div class="text-center mt-4">
        <a href="{{ perfume.url }}" target="_blank" rel="noopener" 
           class="text-[var(--gold)] hover:text-[var(--gold-light)] transition inline-flex items-center gap-2 text-sm">
           <span>üîç</span> View on Fragrantica ‚Üí
        </a>
      </div>
    </div>

    {% if similar_perfumes %}
      <div class="mb-10">
        <h2 class="text-3xl font-bold text-[var(--gold)] mb-6 text-center">You Might Also Love</h2>
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-6">
          {% for p in similar_perfumes %}
            <a href="{% url 'perfume_detail' pk=p.pk %}" 
               class="similar-perfume-card block bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-lg hover:shadow-2xl transition-all p-4"
               aria-label="View details for {{ p.name }} by {{ p.brand }}">
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="Image of {{ p.name }} perfume bottle" 
                     class="w-full h-40 object-cover rounded-lg mb-3 shadow-md">
              {% elif p.image_url %}
                <img src="{{ p.image_url }}" alt="Image of {{ p.name }} perfume bottle" 
                     class="w-full h-40 object-cover rounded-lg mb-3 shadow-md">
              {% else %}
                <div class="w-full h-40 bg-gray-700 rounded-lg mb-3 flex items-center justify-center">
                  <span class="text-4xl opacity-30">‚ú¶</span>
                </div>
              {% endif %}
              <h3 class="text-white font-semibold truncate text-lg">{{ p.name }}</h3>
              <p class="text-gray-400 text-sm">{{ p.brand }}</p>
            </a>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    <div class="section-divider my-10"></div>

    <div class="bg-gradient-to-br from-gray-900/50 to-black/50 rounded-2xl p-6 md:p-8 border border-gray-800">
      <h2 class="text-3xl font-bold text-[var(--gold)] mb-6">Customer Reviews</h2>

      <form method="post" class="mb-8 bg-gray-800/50 rounded-xl p-6 border border-gray-700">
        {% csrf_token %}
        <div class="space-y-4">
          {{ form.as_p }}
        </div>
        <button type="submit" 
                class="luxury-button mt-4 text-black font-bold px-8 py-3 rounded-xl transition duration-300 inline-flex items-center gap-2">
          <span>‚úçÔ∏è</span> Post Review
        </button>
      </form>

      {% if reviews %}
        <div class="space-y-4">
          {% for review in reviews %}
            <div class="review-card p-6 rounded-xl">
              <p class="text-gray-200 mb-3 leading-relaxed text-lg">{{ review.content }}</p>
              <div class="flex items-center justify-between text-sm">
                <p class="text-[var(--gold)] font-semibold">‚Äî {{ review.name }}</p>
                <p class="text-gray-500">{{ review.created_at|date:"M d, Y ‚Ä¢ h:i A" }}</p>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-12">
          <span class="text-6xl opacity-20 mb-4 block">üí¨</span>
          <p class="text-gray-500 text-lg">No reviews yet. Be the first to share your thoughts!</p>
        </div>
      {% endif %}
    </div>

  </div>
</div>

<div hidden>
  <p>Perfume details for {{ perfume.name }} by {{ perfume.brand }}. Find reviews, notes ({{ perfume.top_notes }}, {{ perfume.middle_notes }}, {{ perfume.base_notes }}), and similar fragrances for {{ perfume.name }}.</p>
  <a href="{% url 'perfume_detail' pk=perfume.pk %}" title="Download details for {{ perfume.name }}">Download details for {{ perfume.name }}</a>
</div>
{% endblock %}